// ðŸ§  Convertir texto de prerrequisitos en array
function parsePrereq(texto) {
  if (!texto) return [];
  return texto.split(/ y |,|\/|;/).map(p => p.trim());
}

// âœ… Estado de aprobaciÃ³n
let aprobados = new Set();

function renderMalla() {
  const cont = document.getElementById("malla");
  cont.innerHTML = "";

  mallaData.forEach(s => {
    const divS = document.createElement("div");
    divS.className = "semestre";
    divS.innerHTML = `<h2>Sem ${s.semestre}</h2>`;

    s.ramos.forEach(r => {
      const divR = document.createElement("div");
      divR.className = `ramo ${r.tipo}`;

      const prerreqs = parsePrereq(r.prereq);
      const habilitado = prerreqs.every(req => aprobados.has(req));
      const aprobado = aprobados.has(r.nombre);

      divR.classList.add(habilitado ? "disponible" : "bloqueado");
      if (aprobado) divR.classList.add("aprobado");

      const chk = document.createElement("input");
      chk.type = "checkbox";
      chk.checked = aprobado;

      chk.onclick = (e) => {
        if (e.target.checked) {
          aprobados.add(r.nombre);
        } else {
          aprobados.delete(r.nombre);
        }
        renderMalla();
      };

      divR.appendChild(chk);
      divR.appendChild(document.createTextNode(` ${r.nombre} (${r.creditos})`));
      divR.onclick = () => showInfo(r);
      divS.appendChild(divR);
    });

    cont.appendChild(divS);
  });
}

function showInfo(ramo) {
  document.getElementById("modal-title").innerText = ramo.nombre;
  let texto = `CrÃ©ditos: ${ramo.creditos}`;
  if (ramo.prereq) texto += `\nPrerrequisitos: ${ramo.prereq}`;
  document.getElementById("modal-content").innerText = texto;
  document.getElementById("info-modal").style.display = "flex";
}

window.onload = () => {
  renderMalla();
  document.querySelector(".close").onclick = () =>
    document.getElementById("info-modal").style.display = "none";
};

